<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Gridsome - Gridsome</title><meta name="gridsome:hash" content="ea8cd5eb2bcb61f8fab22e0724090b98cfc22cee"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/gridsome-blog/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/gridsome-blog/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/gridsome-blog/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/gridsome-blog/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/gridsome-blog/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/gridsome-blog/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/gridsome-blog/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/gridsome-blog/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/gridsome-blog/assets/css/0.styles.dd5de3ed.css" as="style"><link rel="preload" href="/gridsome-blog/assets/js/app.3912907c.js" as="script"><link rel="preload" href="/gridsome-blog/assets/js/page--src--templates--post-vue.554c3b45.js" as="script"><link rel="prefetch" href="/gridsome-blog/assets/js/page--node-modules--gridsome--app--pages--404-vue.b08f0808.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--src--pages--index-vue.fe98383b.js"><link rel="stylesheet" href="/gridsome-blog/assets/css/0.styles.dd5de3ed.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><header class="header"><strong><a href="/gridsome-blog/" class="active">Gridsome</a></strong><nav class="nav"><a href="/gridsome-blog/" class="nav__link active">Home</a></nav></header><div class="post-title"><h1>passmenu をカスタマイズしてみました</h1><p class="post-date"> 03 March 2020 | 1 min read</p></div><div class="post-content"><p><p>パスワードマネージャーには <a href="https://www.passwordstore.org/" target="_blank" rel="nofollow noopener noreferrer">Pass / password-store</a> を使っていて、
GUI 環境での入力には <code>passmenu</code> を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、
直接入力させるには <code>--type</code> オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。</p>
<p>オリジナルのソースは <a href="https://git.zx2c4.com/password-store/tree/contrib/dmenu/passmenu" target="_blank" rel="nofollow noopener noreferrer">contrib/dmenu</a> にあります。
pass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。</p>
<pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token builtin class-name">shopt</span> -s nullglob globstar

<span class="token assign-left variable">line</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">=</span>~ ^<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token assign-left variable">line</span><span class="token operator">=</span><span class="token variable">$1</span>
  <span class="token builtin class-name">shift</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token variable">${PASSWORD_STORE_DIR-~<span class="token operator">/</span>.password-store}</span>
<span class="token assign-left variable">password_files</span><span class="token operator">=</span><span class="token punctuation">(</span> <span class="token string">"<span class="token variable">$prefix</span>"</span>/**/*.gpg <span class="token punctuation">)</span>
<span class="token assign-left variable">password_files</span><span class="token operator">=</span><span class="token punctuation">(</span> <span class="token string">"${password_files[@]#"</span><span class="token variable">$prefix</span><span class="token string">"/}"</span> <span class="token punctuation">)</span>
<span class="token assign-left variable">password_files</span><span class="token operator">=</span><span class="token punctuation">(</span> <span class="token string">"<span class="token variable">${password_files<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">%</span>.gpg}</span>"</span> <span class="token punctuation">)</span>

<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">'%s<span class="token entity" title="\n">\n</span>'</span> <span class="token string">"<span class="token variable">${password_files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token operator">|</span> dmenu<span class="token variable">)</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span> -n <span class="token variable">$password</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span>

pass <span class="token variable">$@</span> <span class="token string">"<span class="token variable">$password</span>"</span> <span class="token operator">|</span> <span class="token function">tail</span> -n+<span class="token variable">$line</span> <span class="token operator">|</span> <span class="token function">head</span> -n1 <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'<span class="token entity" title="\n">\n</span>'</span> <span class="token operator">|</span> xdotool <span class="token builtin class-name">type</span> --clearmodifiers --file -</code></pre>
<ul>
<li>直接 type して欲しいときの方が多いのでデフォルト動作を type に変更
(コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……)</li>
<li>複数行に対応するため、1つめの引数が数字であればその行を出力するように変更</li>
<li>otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更</li>
</ul>
<p>などをしました。</p>
<p>dmenu にオプション渡してどうしたいんだろう……と思ってしまいました。 dmenu に慣れていないだけなんでしょうか？
それはともかく、パスワードを pass にがっつり依存してしまっているので、このスクリプトでかなり便利になりました。</p>
<p>pass was written by Jason A. Donenfeld of zx2c4.com and is licensed under the <a href="http://www.gnu.org/licenses/gpl-2.0.html" target="_blank" rel="nofollow noopener noreferrer">GPLv2</a>+</p>
<p>contrib なのでライセンス違うような気もしますがそうでもない気もします。contrib だから違うってことはないか。はい。</p>
</p></div><div class="footer"><p>
      Built with
      <a href="//gridsome.org" class="link">Gridsome</a></p></div></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"id":"ccd8bdc0e4df0fbf95ea66b03ee29f25","title":"passmenu をカスタマイズしてみました","content":"\u003Cp\u003Eパスワードマネージャーには \u003Ca href=\"https:\u002F\u002Fwww.passwordstore.org\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EPass \u002F password-store\u003C\u002Fa\u003E を使っていて、\nGUI 環境での入力には \u003Ccode\u003Epassmenu\u003C\u002Fcode\u003E を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、\n直接入力させるには \u003Ccode\u003E--type\u003C\u002Fcode\u003E オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。\u003C\u002Fp\u003E\n\u003Cp\u003Eオリジナルのソースは \u003Ca href=\"https:\u002F\u002Fgit.zx2c4.com\u002Fpassword-store\u002Ftree\u002Fcontrib\u002Fdmenu\u002Fpassmenu\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Econtrib\u002Fdmenu\u003C\u002Fa\u003E にあります。\npass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-shell\"\u003E\u003Ccode class=\"language-shell\"\u003E\u003Cspan class=\"token shebang important\"\u003E#!\u002Fusr\u002Fbin\u002Fenv bash\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token builtin class-name\"\u003Eshopt\u003C\u002Fspan\u003E -s nullglob globstar\n\n\u003Cspan class=\"token assign-left variable\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"\u003Cspan class=\"token variable\"\u003E$1\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E~ ^\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E-9\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E+$ \u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethen\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token assign-left variable\"\u003Eline\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token variable\"\u003E$1\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token builtin class-name\"\u003Eshift\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efi\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token assign-left variable\"\u003Eprefix\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token variable\"\u003E${PASSWORD_STORE_DIR-~\u003Cspan class=\"token operator\"\u003E\u002F\u003C\u002Fspan\u003E.password-store}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token assign-left variable\"\u003Epassword_files\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"\u003Cspan class=\"token variable\"\u003E$prefix\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E\u002F**\u002F*.gpg \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token assign-left variable\"\u003Epassword_files\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"${password_files[@]#\"\u003C\u002Fspan\u003E\u003Cspan class=\"token variable\"\u003E$prefix\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"\u002F}\"\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token assign-left variable\"\u003Epassword_files\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"\u003Cspan class=\"token variable\"\u003E${password_files\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E@\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E%\u003C\u002Fspan\u003E.gpg}\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token assign-left variable\"\u003Epassword\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token variable\"\u003E\u003Cspan class=\"token variable\"\u003E$(\u003C\u002Fspan\u003E\u003Cspan class=\"token builtin class-name\"\u003Eprintf\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'%s\u003Cspan class=\"token entity\" title=\"\\n\"\u003E\\n\u003C\u002Fspan\u003E'\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"\u003Cspan class=\"token variable\"\u003E${password_files\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E@\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E}\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E dmenu\u003Cspan class=\"token variable\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E -n \u003Cspan class=\"token variable\"\u003E$password\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E||\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin class-name\"\u003Eexit\u003C\u002Fspan\u003E\n\npass \u003Cspan class=\"token variable\"\u003E$@\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"\u003Cspan class=\"token variable\"\u003E$password\u003C\u002Fspan\u003E\"\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Etail\u003C\u002Fspan\u003E -n+\u003Cspan class=\"token variable\"\u003E$line\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Ehead\u003C\u002Fspan\u003E -n1 \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Etr\u003C\u002Fspan\u003E -d \u003Cspan class=\"token string\"\u003E'\u003Cspan class=\"token entity\" title=\"\\n\"\u003E\\n\u003C\u002Fspan\u003E'\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E xdotool \u003Cspan class=\"token builtin class-name\"\u003Etype\u003C\u002Fspan\u003E --clearmodifiers --file -\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cul\u003E\n\u003Cli\u003E直接 type して欲しいときの方が多いのでデフォルト動作を type に変更\n(コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……)\u003C\u002Fli\u003E\n\u003Cli\u003E複数行に対応するため、1つめの引数が数字であればその行を出力するように変更\u003C\u002Fli\u003E\n\u003Cli\u003Eotp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003Eなどをしました。\u003C\u002Fp\u003E\n\u003Cp\u003Edmenu にオプション渡してどうしたいんだろう……と思ってしまいました。 dmenu に慣れていないだけなんでしょうか？\nそれはともかく、パスワードを pass にがっつり依存してしまっているので、このスクリプトでかなり便利になりました。\u003C\u002Fp\u003E\n\u003Cp\u003Epass was written by Jason A. Donenfeld of zx2c4.com and is licensed under the \u003Ca href=\"http:\u002F\u002Fwww.gnu.org\u002Flicenses\u002Fgpl-2.0.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EGPLv2\u003C\u002Fa\u003E+\u003C\u002Fp\u003E\n\u003Cp\u003Econtrib なのでライセンス違うような気もしますがそうでもない気もします。contrib だから違うってことはないか。はい。\u003C\u002Fp\u003E\n","date":"03 March 2020","timeToRead":1}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/gridsome-blog/assets/js/app.3912907c.js" defer></script><script src="/gridsome-blog/assets/js/page--src--templates--post-vue.554c3b45.js" defer></script>
  </body>
</html>
