{"hash":"f96e50d2bba7106fbc4fd8f98e2b5c9b6647e430","data":{"post":{"id":"5a9e24b3785ade53d1a77c6ab4a878ea","title":"RPi に aarch64 の ArchLinux を入れて RTC モジュールを有効化してみる","content":"<p>ArchLinuxARM では簡単に RTC が有効化できた記憶があったのですが、再度試してみると\nうまくいかなかったのでいろいろ試してみました。</p>\n<p>まず、前に設定して動いている Raspbian の <code>dmesg</code> を見てみます。</p>\n<pre class=\"language-text\"><code class=\"language-text\">[    5.310771] rtc-ds1307 1-0068: registered as rtc0</code></pre>\n<p>このログの通り、 <code>/dev/rtc0</code> ができていて、時刻同期はスクリプトで行われます。</p>\n<p>一方、ArchLinuxARM だと以下のようなログが出ていました。</p>\n<pre class=\"language-text\"><code class=\"language-text\">[    7.114025] hctosys: unable to open rtc device (rtc0\n...\n[    7.258978] i2c-bcm2835 3f805000.i2c: Could not read clock-frequency property</code></pre>\n<p><code>/dev/rtc0</code> も起動時は存在しない状態で、\n<code>echo 'ds1307 0x68' | sudo tee /sys/bus/i2c/devices/i2c-1/new_device</code>\nを実行しないといけません。</p>\n<ul>\n<li><a href=\"https://archlinuxarm.org/forum/viewtopic.php?t=11802\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://archlinuxarm.org/forum/viewtopic.php?t=11802</a></li>\n<li><a href=\"https://gist.github.com/Alex131089/de45d552372a9296abbbbe407ae52180\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://gist.github.com/Alex131089/de45d552372a9296abbbbe407ae52180</a></li>\n<li><a href=\"https://raspberrypi.stackexchange.com/questions/38186/how-to-install-real-time-clock-rtc-on-raspbian\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://raspberrypi.stackexchange.com/questions/38186/how-to-install-real-time-clock-rtc-on-raspbian</a></li>\n</ul>\n<p>上記のようなサイトをいくつか参照したのですが、ずばりの(？)解決策は\nなさそうです。よく考えたら Raspbian と違い aarch64 でした……</p>\n<p><code>hctosys</code> は <code>systemd</code> の起動前に(initramfs で)実行されているようです。\ninitramfs 内の udev に認識させればいけそうでしょうか。</p>\n","date":"09 April 2020","timeToRead":1}},"context":{}}