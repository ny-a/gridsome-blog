{"hash":"a89a72b64405c66920c43e61d16ebed104e600c8","data":{"post":{"id":"8005cf4761fddbad749f73ead1ecc791","title":"dockerのインストールでハマりました","content":"<p>Docker のインストールは何度もやったことがあるのですが、稼働中のサーバー上でインストールした経験はなかったので、\n(特殊な状況というか、あまり好ましくない状況ですが)ネットワーク周りで少しハマりました。</p>\n<h2 id=\"背景\"><a href=\"#%E8%83%8C%E6%99%AF\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>背景</h2>\n<p>稼働中のサービスがあるホストで、再起動は避けたい状況でした。</p>\n<p>そのサービスのアップデートをデプロイする前に、docker コンテナ化したアップデート済みサービスを\nデプロイして検証しようとしていました。</p>\n<p>いやまあ検証環境分けろはそうなんですが……。</p>\n<h2 id=\"発生した問題\"><a href=\"#%E7%99%BA%E7%94%9F%E3%81%97%E3%81%9F%E5%95%8F%E9%A1%8C\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>発生した問題</h2>\n<p>centos7 に docker をインストールし、docker-compose でコンテナを起動した所、\n他のコンテナとはネットワークアクセス可能なのに、外部へのアクセスができない状況でした。</p>\n<p>(直接？の原因としては、 iptables の FORWARD チェーンが DROP になっていました。)</p>\n<p>iptables に docker 用のルールが自動で追加されるようなのですが(手元のマシンには追加されていました)、そのホストには\n追加されていませんでした。</p>\n<h2 id=\"解決方法\"><a href=\"#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>解決方法</h2>\n<p><code>systemctl restart docker</code> を実行しました。終わり。</p>\n<h2 id=\"まとめ？\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81%EF%BC%9F\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>まとめ？</h2>\n<p>普通にホスト再起動してあげましょう。\nというかメンテナンスしよ？</p>\n","date":"09 January 2020","timeToRead":1}},"context":{}}