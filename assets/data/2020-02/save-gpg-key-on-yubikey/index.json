{"hash":"067d9ca638bfca0f349a340eaa94546834ee6065","data":{"post":{"id":"4d3d8da8a632f8e9d03862adc89d1d5b","title":"YubikeyにGPGキーを登録しました","content":"<p><a href=\"/2020-02/create-new-gpg-key/\">新しいGPGキーを作成しました</a>\nで GPG キーを作成しましたが、 Yubikey も活用できるように Yubikey にも GPG キーを登録してみました。</p>\n<p>マスターキーの入っている環境で新しくサブキーを作成します。\n<code>ykman piv</code> や <code>gpg</code> コマンドで試した感じでは、手元の Yubikey には RSA 以外の ECDSA/EdDSA のキーを\n登録することができませんでした。\n(Yubikey5 NFC, Firmware 5.1.2 なのでできると思ったのですが……)\nそのため、 RSA 4096bit のサブキーを3種類作成します。</p>\n<p>そして、それぞれ <code>keytocard</code> を実行して、 Yubikey に秘密鍵を移動します。\n移動すると <code>ssb></code> と表示され、 <code>Card serial No.</code>  が表示されます(このあたりがどう保存されているか気になっています)。</p>\n<p>あとは PIN を適宜変更するのですが、 <code>gpg --edit-card</code> と <code>ykman piv</code> で PIN の管理が別なのかはよく分かっていません。\n(登録してみた感じだと別で管理されているようですが、きちんと調べられていません)\n<code>gpg</code> の PIN, Admin PIN, <code>ykman piv</code> の PIN, PUK に加え、 Management Key というものがありますが、\nこれは <code>ykman piv change-management-key -p</code> を実行して PIN を入力することで、 PIN から生成して PIN で認証するように\nすることができます。</p>\n<p>無事登録できたので、<code>password-store</code> では PC に保存しているサブキーと Yubikey に移動したサブキーの両方で\n使えるようにしようと思ったのですが、 gpg では最新の暗号化用のキーを使って暗号化するようで、 キー ID の末尾に <code>!</code> を\nつけないと意図した通りに動きませんでした。</p>\n<p>これで、普段使いのマシンではローカルのサブキーを使って復号化し、それ以外のマシンでは(秘密鍵をインポートしなくても)\nYubikey を使って復号化できるようになりました。\nAndroid では Yubico Authenticator も使ってみようと思いますが、\n<code>password-store</code> で Yubikey を使えると嬉しいなという思いもあり……\nPIV 対応アプリがあるのかは探してみますが、自分で作ることも考えています。</p>\n","date":"05 February 2020","timeToRead":1}},"context":{}}