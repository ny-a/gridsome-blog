{"hash":"27df36cc98fbf91fbb1eb333d95a51ed6a86d1f8","data":{"post":{"id":"3bbe3445e4723f2c93efa639085877d8","title":"OpenSSH8.2でfido2/u2fを試そうとしました","content":"<p>OpenSSH 8.2 がリリースされ、 fido2/u2f が公式にサポートされたようなので試してみました。</p>\n<p>私は ArchLinux を使っているので比較的早くパッケージが降ってきます。\n具体的には、 2020-02-14 にリリースされ、当日中には\ntesting レポジトリに入り、 2020-02-16 03:30Z に core レポジトリに入りました。\ncore に入ったことにより <code>pacman -Syu</code> でインストールできるようになったので試してみましょう。</p>\n<p><a href=\"https://www.openssh.com/txt/release-8.2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">OpenSSH 8.2 のリリースノート</a> を見ると、\n<code>ssh-keygen -t ecdsa-sk</code> で FIDO token backed key を生成することができるようですが、\n試してみると、</p>\n<pre class=\"language-shell\"><code class=\"language-shell\">$ ssh-keygen -t ecdsa-sk                                                                   :<span class=\"token punctuation\">(</span>\nGenerating public/private ecdsa-sk key pair.\nYou may need to <span class=\"token function\">touch</span> your authenticator to authorize key generation.\nProvider <span class=\"token string\">\"\"</span> dlsym<span class=\"token punctuation\">(</span>sk_api_version<span class=\"token punctuation\">)</span> failed: /usr/lib/ssh/ssh-sk-helper: undefined symbol: sk_api_version\nKey enrollment failed: invalid <span class=\"token function\">format</span></code></pre>\n<p>となり失敗します。</p>\n<p><a href=\"https://github.com/Yubico/libfido2/issues/116\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Yubico/libfido2 Issue#116</a>\nを見ると、 <code>ssh-keygen -t ecdsa-sk -w /usr/lib/libsk-libfido2.so</code> を実行すると以下のようなエラーが出ると書かれています。</p>\n<pre class=\"language-shell\"><code class=\"language-shell\">$ ssh-keygen -t ecdsa-sk -w /usr/lib/libsk-libfido2.so                                     :<span class=\"token punctuation\">(</span>\nGenerating public/private ecdsa-sk key pair.\nYou may need to <span class=\"token function\">touch</span> your authenticator to authorize key generation.\nProvider <span class=\"token string\">\"/usr/lib/libsk-libfido2.so\"</span> implements unsupported version 0x00020000 <span class=\"token punctuation\">(</span>supported: 0x00040000<span class=\"token punctuation\">)</span>\nKey enrollment failed: invalid <span class=\"token function\">format</span></code></pre>\n<p><a href=\"https://bugs.archlinux.org/task/65513\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">FS#65513</a>\nにも書かれていますが、これは OpenSSH の configure 時に <code>--with-security-key-builtin</code> オプションを付けてビルドすると\n-w オプションなしで使えるようになるようです。\n上記でパッケージのバグとコメントされているので、数日中に直るでしょう。</p>\n<p>リビルドすれば試せますが、現状は Yubikey で間に合っているので降ってきたら試そうと思っています。</p>\n","date":"17 February 2020","timeToRead":1}},"context":{}}