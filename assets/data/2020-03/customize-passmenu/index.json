{"hash":"d2e1257558cf9cd724191f6436249104f79a28dd","data":{"post":{"id":"ccd8bdc0e4df0fbf95ea66b03ee29f25","title":"passmenu をカスタマイズしてみました","content":"<p>パスワードマネージャーには <a href=\"https://www.passwordstore.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Pass / password-store</a> を使っていて、\nGUI 環境での入力には <code>passmenu</code> を使っているのですが、 passmenu のデフォルト動作は クリップボードへのコピーで、\n直接入力させるには <code>--type</code> オプションを付ける必要があり少し面倒だったので、動作をカスタマイズしてみました。</p>\n<p>オリジナルのソースは <a href=\"https://git.zx2c4.com/password-store/tree/contrib/dmenu/passmenu\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">contrib/dmenu</a> にあります。\npass は全体がそうなのですが、中身はシンプルな bash スクリプトなので、好きなように修正してしまいます。</p>\n<pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\n<span class=\"token builtin class-name\">shopt</span> -s nullglob globstar\n\n<span class=\"token assign-left variable\">line</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">=</span>~ ^<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token punctuation\">]</span>+$ <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token assign-left variable\">line</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\n  <span class=\"token builtin class-name\">shift</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token assign-left variable\">prefix</span><span class=\"token operator\">=</span><span class=\"token variable\">${PASSWORD_STORE_DIR-~<span class=\"token operator\">/</span>.password-store}</span>\n<span class=\"token assign-left variable\">password_files</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"<span class=\"token variable\">$prefix</span>\"</span>/**/*.gpg <span class=\"token punctuation\">)</span>\n<span class=\"token assign-left variable\">password_files</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"${password_files[@]#\"</span><span class=\"token variable\">$prefix</span><span class=\"token string\">\"/}\"</span> <span class=\"token punctuation\">)</span>\n<span class=\"token assign-left variable\">password_files</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"<span class=\"token variable\">${password_files<span class=\"token punctuation\">[</span>@<span class=\"token punctuation\">]</span><span class=\"token operator\">%</span>.gpg}</span>\"</span> <span class=\"token punctuation\">)</span>\n\n<span class=\"token assign-left variable\">password</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">printf</span> <span class=\"token string\">'%s<span class=\"token entity\" title=\"\\n\">\\n</span>'</span> <span class=\"token string\">\"<span class=\"token variable\">${password_files<span class=\"token punctuation\">[</span>@<span class=\"token punctuation\">]</span>}</span>\"</span> <span class=\"token operator\">|</span> dmenu<span class=\"token variable\">)</span></span>\n\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> -n <span class=\"token variable\">$password</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">exit</span>\n\npass <span class=\"token variable\">$@</span> <span class=\"token string\">\"<span class=\"token variable\">$password</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n+<span class=\"token variable\">$line</span> <span class=\"token operator\">|</span> <span class=\"token function\">head</span> -n1 <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> -d <span class=\"token string\">'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span> <span class=\"token operator\">|</span> xdotool <span class=\"token builtin class-name\">type</span> --clearmodifiers --file -</code></pre>\n<ul>\n<li>直接 type して欲しいときの方が多いのでデフォルト動作を type に変更\n(コピーしたかったら pass コマンドを使うので、というか直接 type させる以外する必要ない気が……)</li>\n<li>複数行に対応するため、1つめの引数が数字であればその行を出力するように変更</li>\n<li>otp なども入力できるように、以降の引数は dmenu ではなく pass に渡すように変更</li>\n</ul>\n<p>などをしました。</p>\n<p>dmenu にオプション渡してどうしたいんだろう……と思ってしまいました。 dmenu に慣れていないだけなんでしょうか？\nそれはともかく、パスワードを pass にがっつり依存してしまっているので、このスクリプトでかなり便利になりました。</p>\n<p>pass was written by Jason A. Donenfeld of zx2c4.com and is licensed under the <a href=\"http://www.gnu.org/licenses/gpl-2.0.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GPLv2</a>+</p>\n<p>contrib なのでライセンス違うような気もしますがそうでもない気もします。contrib だから違うってことはないか。はい。</p>\n","date":"03 March 2020","timeToRead":1}},"context":{}}