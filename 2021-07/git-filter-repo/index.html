<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Gridsome - Gridsome</title><meta name="gridsome:hash" content="2be0f42f4ed41b00912ce8a5799549a4c5d421d5"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/gridsome-blog/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/gridsome-blog/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/gridsome-blog/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/gridsome-blog/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/gridsome-blog/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/gridsome-blog/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/gridsome-blog/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/gridsome-blog/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/gridsome-blog/assets/css/0.styles.dd5de3ed.css" as="style"><link rel="preload" href="/gridsome-blog/assets/js/app.fec82fa5.js" as="script"><link rel="preload" href="/gridsome-blog/assets/js/page--src--templates--post-vue.554c3b45.js" as="script"><link rel="prefetch" href="/gridsome-blog/assets/js/page--node-modules--gridsome--app--pages--404-vue.b08f0808.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--src--pages--index-vue.fe98383b.js"><link rel="stylesheet" href="/gridsome-blog/assets/css/0.styles.dd5de3ed.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><header class="header"><strong><a href="/gridsome-blog/" class="active">Gridsome</a></strong><nav class="nav"><a href="/gridsome-blog/" class="nav__link active">Home</a></nav></header><div class="post-title"><h1>git filter-repoを使ってみました</h1><p class="post-date"> 03 July 2021 | 1 min read</p></div><div class="post-content"><p><p>Git を使っていて、何らかの理由でコミット履歴を書き換えたいとき、
標準サブコマンドの中でよく使われるのは filter-branch でしょう。</p>
<p>ただ、<a href="https://git-scm.com/docs/git-filter-branch" target="_blank" rel="nofollow noopener noreferrer">公式ドキュメント</a>
を見てみると、filter-branch を使う代わりに、
<a href="https://github.com/newren/git-filter-repo" target="_blank" rel="nofollow noopener noreferrer">filter-repo</a>
というサードパーティーの代替などを使うように警告されます。</p>
<p>そこで、filter-repo を使ってみました。
ArchLinux では <a href="https://archlinux.org/packages/community/any/git-filter-repo/" target="_blank" rel="nofollow noopener noreferrer">community/git-filter-repo</a>
からインストールできます。</p>
<p>今回やりたいことは (いつも同じで)、個人で使っているこのアカウントが
Author/Committer となっているコミットを、仕事で使っている情報に書き換えることです。
(毎回 git config をやり忘れるの、何か対策したいところですが……。)</p>
<p>ドキュメントを見てみると、どうもあまりオプションはないようです。
というより、Python のコードをオプションとして渡してあげると、
いい感じに実行してくれるようです。</p>
<p>今回はまだ自分しかコミットしていないリポジトリだったので、
常に同じバイナリ列 (文字列ではダメです) を返すコードを書きます。</p>
<p>……その前に、バックアップを取っておきます。
filter-repo では、clone したばかりの clean なリポジトリを使うことが推奨されています。
/tmp で <code>git clone /path/to/repository --no-local</code> を実行して、リポジトリを複製します。</p>
<p>次に、実際の書き換えを行っていきます。
<code>--email-callback</code> と <code>--name-callback</code> を使います。
どちらも現在の値を考慮する必要はないため、
<code>"return b'user@example.com'"</code> のような引数を与えればいいです。</p>
<p>そして実行すると……、一瞬で終わりました。
filter-branch では original が残りますが、filter-repo では残らないようです。
軽く見た感じ問題なく完了しているようなので、
<code>git push /path/to/repository branch:branch_new</code> を実行して、
元のリポジトリに書き換えたコミットを push します。</p>
<p>元のブランチと diff を取って、当然何も出ないことを確認したら、
<code>git reset --hard branch_new</code> したり、
<code>git branch -f branch branch_new</code> したりして古いブランチを新しいブランチに移動します。</p>
<p>あとは、必要に応じて force push したり(関係するメンバーに謝りましょう……)、
運よく push していなければ、もう二度と同じ誤ちを繰り返さないように心に誓ったりしましょう。</p>
</p></div><div class="footer"><p>
      Built with
      <a href="//gridsome.org" class="link">Gridsome</a></p></div></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"id":"4843695414edfabaf84ec8d875bbb8ae","title":"git filter-repoを使ってみました","content":"\u003Cp\u003EGit を使っていて、何らかの理由でコミット履歴を書き換えたいとき、\n標準サブコマンドの中でよく使われるのは filter-branch でしょう。\u003C\u002Fp\u003E\n\u003Cp\u003Eただ、\u003Ca href=\"https:\u002F\u002Fgit-scm.com\u002Fdocs\u002Fgit-filter-branch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003E公式ドキュメント\u003C\u002Fa\u003E\nを見てみると、filter-branch を使う代わりに、\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fnewren\u002Fgit-filter-repo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Efilter-repo\u003C\u002Fa\u003E\nというサードパーティーの代替などを使うように警告されます。\u003C\u002Fp\u003E\n\u003Cp\u003Eそこで、filter-repo を使ってみました。\nArchLinux では \u003Ca href=\"https:\u002F\u002Farchlinux.org\u002Fpackages\u002Fcommunity\u002Fany\u002Fgit-filter-repo\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ecommunity\u002Fgit-filter-repo\u003C\u002Fa\u003E\nからインストールできます。\u003C\u002Fp\u003E\n\u003Cp\u003E今回やりたいことは (いつも同じで)、個人で使っているこのアカウントが\nAuthor\u002FCommitter となっているコミットを、仕事で使っている情報に書き換えることです。\n(毎回 git config をやり忘れるの、何か対策したいところですが……。)\u003C\u002Fp\u003E\n\u003Cp\u003Eドキュメントを見てみると、どうもあまりオプションはないようです。\nというより、Python のコードをオプションとして渡してあげると、\nいい感じに実行してくれるようです。\u003C\u002Fp\u003E\n\u003Cp\u003E今回はまだ自分しかコミットしていないリポジトリだったので、\n常に同じバイナリ列 (文字列ではダメです) を返すコードを書きます。\u003C\u002Fp\u003E\n\u003Cp\u003E……その前に、バックアップを取っておきます。\nfilter-repo では、clone したばかりの clean なリポジトリを使うことが推奨されています。\n\u002Ftmp で \u003Ccode\u003Egit clone \u002Fpath\u002Fto\u002Frepository --no-local\u003C\u002Fcode\u003E を実行して、リポジトリを複製します。\u003C\u002Fp\u003E\n\u003Cp\u003E次に、実際の書き換えを行っていきます。\n\u003Ccode\u003E--email-callback\u003C\u002Fcode\u003E と \u003Ccode\u003E--name-callback\u003C\u002Fcode\u003E を使います。\nどちらも現在の値を考慮する必要はないため、\n\u003Ccode\u003E\"return b'user@example.com'\"\u003C\u002Fcode\u003E のような引数を与えればいいです。\u003C\u002Fp\u003E\n\u003Cp\u003Eそして実行すると……、一瞬で終わりました。\nfilter-branch では original が残りますが、filter-repo では残らないようです。\n軽く見た感じ問題なく完了しているようなので、\n\u003Ccode\u003Egit push \u002Fpath\u002Fto\u002Frepository branch:branch_new\u003C\u002Fcode\u003E を実行して、\n元のリポジトリに書き換えたコミットを push します。\u003C\u002Fp\u003E\n\u003Cp\u003E元のブランチと diff を取って、当然何も出ないことを確認したら、\n\u003Ccode\u003Egit reset --hard branch_new\u003C\u002Fcode\u003E したり、\n\u003Ccode\u003Egit branch -f branch branch_new\u003C\u002Fcode\u003E したりして古いブランチを新しいブランチに移動します。\u003C\u002Fp\u003E\n\u003Cp\u003Eあとは、必要に応じて force push したり(関係するメンバーに謝りましょう……)、\n運よく push していなければ、もう二度と同じ誤ちを繰り返さないように心に誓ったりしましょう。\u003C\u002Fp\u003E\n","date":"03 July 2021","timeToRead":1}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/gridsome-blog/assets/js/app.fec82fa5.js" defer></script><script src="/gridsome-blog/assets/js/page--src--templates--post-vue.554c3b45.js" defer></script>
  </body>
</html>
